
<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='UTF-8'>
        <meta name = 'viewport' content='width=device-width, initial-scale=1'>
        <title>Chenfeng Li</title>
        <link rel="icon" type="image/x-icon" href="image/icon/icon.png">

        <script src="https://kit.fontawesome.com/4dd2f70620.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href='css/style.css'>
        <script type="text/javascript" src="js/script.js"></script>

    </head>

    <body>

        <header id='header'>

            <i id="navbar" class="fa fa-bars" aria-hidden="true" isopen="True" onclick="clicknav()"></i>
            <div id="mobileNavBar">
                <ul id='navList'>
                    <li id="abo"><a id='top' href='index.html' aria-label='Home' class='navContent active'>About Me</a></li>
                    <li id="resume"><a  href='resume.html' aria-label='Resume' class='navContent'>Resume</a></li>
                    <li id="pro"><a  href='profession.html' aria-label='Profession' class='navContent'>Profession</a></li>
                    <li id="res"><a  href='research.html' aria-label='Research' class='navContent'>Research</a></li>
                </ul>
            </div>
            <div id="h1container"><a href='index.html'><h1 id="h1">Chenfeng LI</h1></a></div>
        </header>




        <main>
        	<div id="bodyText">

                <div id='aboutimg'>
                    <h2>Aerial Photo Segmentation Model Demo</h2>
                    This model distinguish different types of land (e.g. buildings, roads, trees, etc) from an bird-eye aerial or satelite photo. <br><br>

            <div id="model_test">
                <h3>Test the model:</h3>

                <p>
                    Upload an aerial photo:
                    <input id="imageInput" type="file" name="image" accept="image/*" />
                </p>

                <p>
                    <label>
                    <input id="combineCheckbox" type="checkbox" />
                    Cover labels on the original photo
                    </label>
                </p>

                <p>
                    <button id="submitBtn" type="button">Show the label prediction</button>
                    <span id="statusText" style="margin-left: 10px;"></span>
                </p>

                <div style="margin-top:12px;">
                <div style="margin-bottom:24px;">
                    <p style="margin:0 0 6px 0;">Input preview</p>
                    <img
                    id="inputPreview"
                    style="max-width:420px; display:none; border:1px solid #ddd; border-radius:8px;"
                    />
                </div>

                <div>
                    <p style="margin:0 0 6px 0;">Model output</p>
                    <img
                    id="outputPreview"
                    style="max-width:420px; display:none; border:1px solid #ddd; border-radius:8px;"
                    />
                </div>
                </div>

            </div>

            <script>
            // >>> CHANGE THIS if your API URL changes:
            const API_BASE = "https://chenfeng-image-api-432979633430.us-central1.run.app";
            const PREDICT_URL = `${API_BASE}/predict/image`;

            const imageInput = document.getElementById("imageInput");
            const combineCheckbox = document.getElementById("combineCheckbox");
            const submitBtn = document.getElementById("submitBtn");
            const statusText = document.getElementById("statusText");
            const inputPreview = document.getElementById("inputPreview");
            const outputPreview = document.getElementById("outputPreview");

            let selectedFile = null;

            // 1) When a photo is uploaded, display it
            imageInput.addEventListener("change", () => {
                const file = imageInput.files && imageInput.files[0];
                selectedFile = file || null;

                outputPreview.style.display = "none";
                outputPreview.src = "";

                if (!file) {
                inputPreview.style.display = "none";
                inputPreview.src = "";
                statusText.textContent = "";
                return;
                }

                // Preview input image
                const url = URL.createObjectURL(file);
                inputPreview.src = url;
                inputPreview.style.display = "block";
                statusText.textContent = "";
            });

            // 3) On submit: call API and display output
            submitBtn.addEventListener("click", async () => {
                if (!selectedFile) {
                statusText.textContent = "Please choose an image first.";
                return;
                }

                const combine = combineCheckbox.checked; // 2) checkbox -> combine
                const url = `${PREDICT_URL}?combine=${combine ? "true" : "false"}`;

                // Prepare multipart/form-data
                const form = new FormData();
                // IMPORTANT: the field name must match FastAPI parameter name: file: UploadFile = File(...)
                form.append("file", selectedFile);

                try {
                submitBtn.disabled = true;
                statusText.textContent = "Running model...";
                outputPreview.style.display = "none";
                outputPreview.src = "";

                const resp = await fetch(url, {
                    method: "POST",
                    body: form,
                });

                if (!resp.ok) {
                    const text = await resp.text();
                    throw new Error(`API error ${resp.status}: ${text}`);
                }

                const blob = await resp.blob();  // should be image/png
                const outUrl = URL.createObjectURL(blob);

                outputPreview.src = outUrl;
                outputPreview.style.display = "block";
                statusText.textContent = "Done.";
                } catch (err) {
                console.error(err);
                statusText.textContent = "Failed. Open DevTools console for details.";
                } finally {
                submitBtn.disabled = false;
                }
            });
            </script>


                    <br><br>
                    <div id='gallary'>
                        <h3>Example:</h3>
                        <figure contenteditable='false' class='figureimg'>
                            <img src='image/model/test.png'>
                            <figcaption dir='auto'>Upload an aerial photo</figcaption>
                        </figure>

                        <figure contenteditable='false' class='figureimg'>
                            <img src='image/model/label.png'>
                            <figcaption dir='auto'>Label prediction of land type</figcaption>
                        </figure>

                        <figure contenteditable='false' class='figureimg'>
                            <img src='image/model/combined.png'>
                            <figcaption dir='auto'>Alternatively. Cover labels on the original photo</figcaption>
                        </figure>
                    </div> 
                    <br><br>
                    
                </div>


        		
            </div>



        </main>


        <footer>
            <p id='update'>Last updated on Aug 14, 2025</p>
            <p> &copy Chenfeng Li, 2023-2025</p>
            <p>
                <a href='mailto:cfli@chenfengli.com'><i class="fa-regular fa-envelope"></i></a>
                <a href='https://www.linkedin.com/in/chenfengli/' target='_blank'><i class="fa-brands fa-linkedin"></i></a>
                <a href='https://github.com/Chenfeng-Li' target='_blank'><i class="fa-brands fa-github"></i></a>

            </p>
        </footer>



	</body>


</html>