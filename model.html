
<!DOCTYPE html>
<html lang='en'>
    <head>
        <meta charset='UTF-8'>
        <meta name = 'viewport' content='width=device-width, initial-scale=1'>
        <title>Chenfeng Li</title>
        <link rel="icon" type="image/x-icon" href="image/icon/icon.png">

        <script src="https://kit.fontawesome.com/4dd2f70620.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href='css/style.css'>
        <script type="text/javascript" src="js/script.js"></script>

    </head>

    <body>

        <header id='header'>

            <i id="navbar" class="fa fa-bars" aria-hidden="true" isopen="True" onclick="clicknav()"></i>
            <div id="mobileNavBar">
                <ul id='navList'>
                    <li id="abo"><a id='top' href='index.html' aria-label='Home' class='navContent active'>About Me</a></li>
                    <li id="resume"><a  href='resume.html' aria-label='Resume' class='navContent'>Resume</a></li>
                    <li id="pro"><a  href='profession.html' aria-label='Profession' class='navContent'>Profession</a></li>
                    <li id="res"><a  href='research.html' aria-label='Research' class='navContent'>Research</a></li>
                </ul>
            </div>
            <div id="h1container"><a href='index.html'><h1 id="h1">Chenfeng LI</h1></a></div>
        </header>




        <main>
        	<div id="bodyText">

                <div id='aboutimg'>
                    <h2>Aerial Photo Segmentation Model Demo</h2>
                    This model distinguish different types of land (e.g. buildings, roads, trees, etc) from an bird-eye aerial or satelite photo. <br><br>

            <div id="model_test">
                <h3>Test the model:</h3>

                <p>
                    Upload an aerial photo:
                    <input id="imageInput" type="file" accept="image/*" />
                </p>

                <p>
                    <label>
                    <input id="combineCheckbox" type="checkbox" />
                    Cover labels on the original photo
                    </label>
                </p>

                <p>
                    <button id="submitBtn" type="button">Show the label prediction</button>
                    <span id="statusText"></span>
                </p>

                <div class="model-figures">
                    <!-- Input preview -->
                    <figure contenteditable="false" class="figureimg2">
                    <img id="inputPreview" alt="Input preview" style="display:none;" />
                    <figcaption>Input preview</figcaption>
                    </figure>
                    
                    
                    <!-- Output preview -->
                    <figure contenteditable="false" class="figureimg2">
                    <img id="outputPreview" alt="Model output" style="display:none;" />
                    <figcaption>Model output</figcaption>
                    </figure>
                </div>
                </div>

                <script>

                    const API_BASE = "https://chenfeng-image-api-432979633430.us-central1.run.app";
                    const PREDICT_URL = `${API_BASE}/predict/image`;

                    const imageInput = document.getElementById("imageInput");
                    const combineCheckbox = document.getElementById("combineCheckbox");
                    const submitBtn = document.getElementById("submitBtn");
                    const statusText = document.getElementById("statusText");
                    const inputPreview = document.getElementById("inputPreview");
                    const outputPreview = document.getElementById("outputPreview");

                    let selectedFile = null;

                    // 1) Show input preview when a photo is uploaded
                    imageInput.addEventListener("change", () => {
                        const file = imageInput.files && imageInput.files[0];
                        selectedFile = file || null;

                        // clear old output
                        outputPreview.style.display = "none";
                        outputPreview.src = "";

                        if (!file) {
                        inputPreview.style.display = "none";
                        inputPreview.src = "";
                        statusText.textContent = "";
                        return;
                        }

                        const url = URL.createObjectURL(file);
                        inputPreview.src = url;
                        inputPreview.style.display = "block";
                        statusText.textContent = "";
                    });

                    // 3) Submit -> call API -> show output
                    submitBtn.addEventListener("click", async () => {
                        if (!selectedFile) {
                        statusText.textContent = "Please choose an image first.";
                        return;
                        }

                        const combine = combineCheckbox.checked; // 2) checkbox -> combine
                        const url = `${PREDICT_URL}?combine=${combine ? "true" : "false"}`;

                        const form = new FormData();
                        form.append("file", selectedFile); // must be "file" to match FastAPI param name

                        try {
                        submitBtn.disabled = true;
                        statusText.textContent = "Running model...";

                        const resp = await fetch(url, { method: "POST", body: form });

                        if (!resp.ok) {
                            const text = await resp.text();
                            throw new Error(`API error ${resp.status}: ${text}`);
                        }

                        const blob = await resp.blob(); // image/png
                        const outUrl = URL.createObjectURL(blob);

                        outputPreview.src = outUrl;
                        outputPreview.style.display = "block";
                        statusText.textContent = "Done.";
                        } catch (err) {
                        console.error(err);
                        statusText.textContent = "Failed. Check browser console.";
                        } finally {
                        submitBtn.disabled = false;
                        }
                    });
                </script>



                    <br><br>
                    <div id='gallary'>
                        <h3>Example:</h3>
                        <figure contenteditable='false' class='figureimg2'>
                            <img src='image/model/test.png'>
                            <figcaption dir='auto'>Upload an aerial photo</figcaption>
                        </figure>

                        <figure contenteditable='false' class='figureimg2'>
                            <img src='image/model/label.png'>
                            <figcaption dir='auto'>Label prediction of land type</figcaption>
                        </figure>

                        <figure contenteditable='false' class='figureimg2'>
                            <img src='image/model/combined.png'>
                            <figcaption dir='auto'>Alternatively. Cover labels on the original photo</figcaption>
                        </figure>
                    </div> 
                    <br><br>
                    
                </div>


        		
            </div>



        </main>


        <footer>
            <p id='update'>Last updated on Aug 14, 2025</p>
            <p> &copy Chenfeng Li, 2023-2025</p>
            <p>
                <a href='mailto:cfli@chenfengli.com'><i class="fa-regular fa-envelope"></i></a>
                <a href='https://www.linkedin.com/in/chenfengli/' target='_blank'><i class="fa-brands fa-linkedin"></i></a>
                <a href='https://github.com/Chenfeng-Li' target='_blank'><i class="fa-brands fa-github"></i></a>

            </p>
        </footer>



	</body>


</html>